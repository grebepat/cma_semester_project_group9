<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maurin Huonder and Patrick Greber">
<meta name="dcterms.date" content="2024-06-23">

<title>Cycling Secrets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="index_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="index_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research Questions</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cycling Secrets</h1>
<p class="subtitle lead">Decoding bike messenger paths for efficiency</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maurin Huonder and Patrick Greber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
     p {
        text-align: justify;
      }
      h1, h2, h3, h4, h5, h6 {
        text-align: left;
      }
</style>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## loading necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggh4x"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sp"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"terra"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tmap"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"zoo"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"leaflet"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"XML"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"forcats"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"httr"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"hereR"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"png"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"purrr"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggridges"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"agricolae"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>This work explores the possibility of determining how bike messengers in Zurich perceive their route choices. This is done by comparing chosen trajectories with auto generated alternative trajectories. We compare paths of chosen routes (deliveries) with a generated set of modeled routes (choice-set/alternatives) in terms of distance traveled, slope and street width. Our analysis is based on 95 shift performed by 2 messengers. Street network and type and width were taken from the Swisstlm3d data set. For further attributes such as slope and height, the DHM25 was considered.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Route choice models play an important role in many transport applications, for example, intelligent transport systems, GPS navigation and transportation planning <span class="citation" data-cites="frejinger_route_2007">(<a href="#ref-frejinger_route_2007" role="doc-biblioref">Frejinger 2007</a>)</span>. Modeling route choice behavior is essential, given the possibility to appraise travelers perceptions of route characteristics and to forecast travelers’ behavior under hypothetical scenarios <span class="citation" data-cites="prato_route_2009">(<a href="#ref-prato_route_2009" role="doc-biblioref">Prato 2009</a>)</span>. Route choice models can assess travelers’ perceptions of various route characteristics such as distance, travel time, cost, number of traffic lights and road types, and relate the results to the individuals’ characteristics (e.g.&nbsp;gender, age, income and trip purpose) and can not only help analyzing and understanding travelers’ behavior, but also constitute the essential part of traffic assignment methods. Several studies have used route choice modelling to investigate preferences of cyclists in cities for different purposes such as effectiveness of investments in bicycle infrastructure <span class="citation" data-cites="hood_gps-based_2011">(<a href="#ref-hood_gps-based_2011" role="doc-biblioref">Hood, Sall, and Charlton 2011</a>)</span>. <span class="citation" data-cites="skov-petersen_how_2018">Skov-Petersen et al. (<a href="#ref-skov-petersen_how_2018" role="doc-biblioref">2018</a>)</span> investigated route choices by cyclists in Copenhagen (Denmark). The authors found that cyclists expressed a negative utility for length and turns, indicating a preference for shorter and more direct routes. Furthermore they were sensitive to factors such as length, cycling the wrong way, turn frequency and terrain gradient.</p>
<p>A challenge in working with route choice models is the generation of plausible alternative routes. <span class="citation" data-cites="broach2012cyclists">Broach, Dill, and Gliebe (<a href="#ref-broach2012cyclists" role="doc-biblioref">2012</a>)</span> applied various route choice methods to generate routes in Portland. The results reported in the study showed that only 25% of the generated routes replicated the actual routes, and 42.3% of the routes with an 80% overlap. <span class="citation" data-cites="hood_gps-based_2011">Hood, Sall, and Charlton (<a href="#ref-hood_gps-based_2011" role="doc-biblioref">2011</a>)</span> applied the simulation method to generate routes (the doubly stochastic method) in San Francisco. In contrast to other studies, they added environmental and socioeconomic variables to the cost function, such as crime hot-spots, light and weather conditions. However, as in <span class="citation" data-cites="broach2012cyclists">Broach, Dill, and Gliebe (<a href="#ref-broach2012cyclists" role="doc-biblioref">2012</a>)</span>, the capture rates were very low (around 30%). <span class="citation" data-cites="menghini2009route">Menghini et al. (<a href="#ref-menghini2009route" role="doc-biblioref">2009</a>)</span> used the angle elimination method to generate routes in Zurich. The cost function used was limited to driving distance. In the study by <span class="citation" data-cites="halldorsdottir2014efficiency">Halldórsdóttir et al. (<a href="#ref-halldorsdottir2014efficiency" role="doc-biblioref">2014</a>)</span> in Copenhagen, the cost functions included land use and road type. They added a random component to these values to create a representative route choice set. The coverage results (70 %) were better compared to the previous studies. The researchers explored different methods to generate bike routes, but achieving accurate overlap and high capture rates remains challenging.</p>
<p>This work takes a different approach, exploring the route choices of bike messengers instead of analyzing the route choice of commuters or leisure cyclists. Analyzing the route choices of bike messengers compared to ordinary cyclists can provide insights into efficiency and safety. Due to the fact that bike messengers, are often under time pressure and have a excellent knowledge of the street network, they may choose faster routes, even if they are longer in terms of distance. Additionally, as experienced cyclists, bike messengers can also choose safer or less traveled routes, which can lead to conclusions for the general safety of all cyclists in cities. Furthermore, routes chosen by bike messengers can offer important data on the usage of the city’s cycling infrastructure. This can guide decisions on where to focus improvements and enhance route planning and traffic management.</p>
</section>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research Questions</h2>
<ol type="1">
<li><p>Do bike messengers always choose the shortest possible route during their deliveries?</p></li>
<li><p>How do street network attributes influence the route choice behavior of bike messengers in Zurich?</p></li>
</ol>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="context-data" class="level3">
<h3 class="anchored" data-anchor-id="context-data">Context Data</h3>
<p>All contextual data for enriching the route network is sourced from open-source platforms. SwissTLM3D<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> provided the street network, street type, and width. The digital terrain model DHM25<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> was used for obtaining the slope of the streets. DHM25 is available with a resolution of 0.5 meters. The contextual data was preprocessed using Quantum GIS Version 3.34.5. All spatial data has been clipped to the outline of the city of Zurich beforehand.</p>
</section>
<section id="gps-data" class="level3">
<h3 class="anchored" data-anchor-id="gps-data">GPS Data</h3>
<p>We utilized GPS data collected with the fitness-tracking-app Strava<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> . The data was collected by two bike messengers in Zurich and conducted as GPX files. The two messengers have been assigned aliases for the purpose of this analysis. They are referred to as <code>donner</code> and <code>raeubertochter</code>. The data encompasses 95 shifts, with each shift including multiple deliveries. The shifts vary in terms of distance traveled, working hours, season, weather and the number of deliveries. The available movement data consists of a total of 821’770 gps points tracked between 01.09.2022 09:39:33 and 06.05.2024 18:16:19.</p>
<p>Due to the large amount of data and our limited access to the later used API by <code>here</code>, we reduce the data set to one shift <code>F1</code> per messenger. Raw gps data per messenger for the shift F1 is shown in <a href="#fig-raw_data" class="quarto-xref">Figure&nbsp;1</a>.</p>
<ul>
<li><p>The reduced movement data of <code>raeubertochter</code> extends from 23.10.2023 12:59:44 to 23.10.2023 17:51:21, and consists of a total of <strong>7102 gps points</strong>.</p></li>
<li><p>The reduced movement data of <code>donner</code> extends from 30.01.2024 10:21:41 to 30.01.2024 22:14:27 and consists of a total of <strong>4597 gps points</strong>.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## generate a list of all filenames including the path from the subfolder they are stored in</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"gps_files_shared"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.gpx$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to extract messenger and id from file path</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>extract_info <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  messenger <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">gsub</span>(<span class="st">".*/gps_files_([^/]+)/.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, file))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="st">'.*/(.*).gpx'</span>,<span class="st">'</span><span class="sc">\\</span><span class="st">1'</span>, file), <span class="fu">gsub</span>(<span class="st">".*/gps_files_([^/]+)/.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, file), <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">messenger =</span> messenger, <span class="at">id =</span> id)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to process each file</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>process_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">st_read</span>(file, <span class="st">"track_points"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  info <span class="ot">&lt;-</span> <span class="fu">extract_info</span>(file)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>messenger <span class="ot">&lt;-</span> info<span class="sc">$</span>messenger</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>id <span class="ot">&lt;-</span> info<span class="sc">$</span>id</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  df_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  df_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(df_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  df_sf<span class="sc">$</span>shift <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">'.*/(.*).gpx'</span>,<span class="st">'</span><span class="sc">\\</span><span class="st">1'</span>, file)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  df_sf<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(df_sf)[,<span class="dv">1</span>]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  df_sf<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(df_sf)[,<span class="dv">2</span>]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  df_sf <span class="ot">&lt;-</span> <span class="fu">select</span>(df_sf, id, messenger, shift, time, x, y, ele, geometry)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  df_sf<span class="sc">$</span>origin <span class="ot">&lt;-</span> file</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  df_sf</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Apply the function to each file using purrr's map function</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>single_routes <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(file, process_file)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine all results</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>all_routes <span class="ot">&lt;-</span> <span class="fu">reduce</span>(single_routes, bind_rows)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(all_routes, <span class="at">file =</span> <span class="st">"rda_files/all_routes.rda"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Seperate file into raeubertochter and donner and save output for visualizations under preprocessing.qmd</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>raeubertochter_raw <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes, messenger <span class="sc">==</span> <span class="st">"raeubertochter"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(raeubertochter_raw, <span class="at">file =</span> <span class="st">"rda_files/raeubertochter_raw.rda"</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>donner_raw <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes, messenger <span class="sc">==</span> <span class="st">"donner"</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(donner_raw, <span class="at">file =</span> <span class="st">"rda_files/donner_raw.rda"</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Our raw data covers one shift per messenger, a total of 11'699 fixes were recorded:</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="do">### raeubertochter: 23.10.2023, 12:59:44 to 06.05.2024, 18:16:19, 654554 fixes</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="do">### donner: 01.09.2022, 09:39:33 to 20.02.2024 20:55:54, 167216 fixes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-raw_data" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-raw_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-raw_data" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-raeubertochter_raw" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-raeubertochter_raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/raeubertochter_raw.png" class="lightbox" data-gallery="fig-raw_data" title="Figure&nbsp;1&nbsp;(a): raeubertochter"><img src="figures/raeubertochter_raw.png" class="img-fluid figure-img" data-ref-parent="fig-raw_data"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-raeubertochter_raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) raeubertochter
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-raw_data" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-donner_raw" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-donner_raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/donner_raw.png" class="lightbox" data-gallery="fig-raw_data" title="Figure&nbsp;1&nbsp;(b): donner"><img src="figures/donner_raw.png" class="img-fluid figure-img" data-ref-parent="fig-raw_data"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-donner_raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) donner
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-raw_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Raw gps data reduced to the shift F1 for <code>raeubertochter</code> and <code>donner</code>
</figcaption>
</figure>
</div>
<p>We assess the tracking intervals from <code>raeubertochter</code> and <code>donner</code> as both used different tracking devices. The analysis later allows for an appropriate definition of a threshold for the segmentation of the raw data into separated trajectories. Both messengers have similar tracking intervals, with mean time differences between fixes of 2.91 seconds for <code>donner</code> and 1.04 seconds for <code>raeubertochter</code>. Mean time difference was estimated after removing values over 30 seconds to get a clearer view on average tracking intervals. The tracking intervals are shown in <a href="#fig-sampling" class="quarto-xref">Figure&nbsp;2</a> and illustrate that most gps points follow eachother within 10 seconds.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## If a larger sampling grid is needed: selecting every 10th row from  movement data:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">###all_routes &lt;- all_routes[seq(from = 1, to = #nrow(all_routes), by = 5), ]</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate rowwise time difference</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>all_routes <span class="ot">&lt;-</span> all_routes <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_difference =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(time, <span class="fu">lag</span>(time), <span class="at">units =</span> <span class="st">"secs"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="do">## How do the time difference differ between messengers?</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>all_routes <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(messenger) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_difference <span class="sc">&lt;=</span> <span class="dv">30</span>) <span class="sc">|&gt;</span> <span class="co"># remove outliers to get a clearer view on the average sampling interval</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(time_difference, <span class="at">na.rm =</span> T)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="do">## donner: 2.91, raeubertochter: 1.04</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Both with similar time difference between fixes, raeubertochter with slightly shorter intervals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-sampling" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/sampling_intervall.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;2: Assessing tracking intervals for donner and raeubertochter"><img src="figures/sampling_intervall.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Assessing tracking intervals for <code>donner</code> and <code>raeubertochter</code>
</figcaption>
</figure>
</div>
</section>
</section>
<section id="methods" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="from-dots-to-drops-segmenting-gps-fixes-into-deliveries" class="level3">
<h3 class="anchored" data-anchor-id="from-dots-to-drops-segmenting-gps-fixes-into-deliveries">From Dots to Drops: Segmenting GPS Fixes into Deliveries</h3>
<p>The segmentation of GPS data into different segments was achieved by analyzing the time differences between consecutive data points. Since the Strava-App data already eliminates most static points, it allowed us to rely solely on significant time gaps for the segmentation. Thus, a moving time window was created for each route, and the mean time difference was calculated for each messenger. A new segment was then defined as any instance where the mean time difference exceeded a threshold of 20 seconds. A total of 112 trajectories was computed.</p>
<p>The data was further refined by removing static rows and any segments shorter than two minutes resulting in the exclusion of 54 segments. Each segment was then assigned a <code>segment_ID</code>. The number of differentiated segments was calculated for each messenger, resulting in 36 deliveries for <code>donner</code>, and 22 deliveries for <code>raeubertochter</code> as shown in <a href="#fig-seg_data" class="quarto-xref">Figure&nbsp;3</a>. A total of 1162 segments for <code>donner</code> and 1662 segments for <code>raeubertochter</code> would have been separated, if all messenger data was included in the analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For seperating the gps data into different segments, we analyse time differences between them. As strava data already removes most of the static points we're in no need to calculate mean_step's but can solely relay on big time gaps.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## create a moving time window</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes <span class="sc">|&gt;</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">nMinus2 =</span> <span class="fu">difftime</span>(time, <span class="fu">lag</span>(time, <span class="dv">2</span>)), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">nMinus1 =</span> <span class="fu">difftime</span>(time, <span class="fu">lag</span>(time,<span class="dv">1</span>)),  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">nPlus1  =</span> <span class="fu">difftime</span>(<span class="fu">lead</span>(time, <span class="dv">1</span>), time), </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">nPlus2  =</span> <span class="fu">difftime</span>(<span class="fu">lead</span>(time, <span class="dv">2</span>), time)  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate rowwise mean distance per messenger</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes_seg <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> (nMinus2 <span class="sc">+</span> nMinus1 <span class="sc">+</span> nPlus1 <span class="sc">+</span> nPlus2) <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="do">## create a new column static, based on time_difference (over 20s time difference)</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes_seg <span class="sc">|&gt;</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_segment =</span> timeMean <span class="sc">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="do">## As strava already removed most static points, we're able to seperate segments via time_difference only. We work with a treshold t of 20 seconds.</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="do">## it assigns unique IDs based on the column static</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>rle_id <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rle</span>(vec)<span class="sc">$</span>lengths</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">seq_along</span>(x), <span class="at">times =</span> x))</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="do">## removes static rows</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes_seg <span class="sc">|&gt;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">temp_id =</span> <span class="fu">rle_id</span>(new_segment)) <span class="sc">|&gt;</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>new_segment)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(all_routes_seg<span class="sc">$</span>temp_id))</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="do">## remove segments shorter than two minuntes</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes_seg <span class="sc">|&gt;</span> </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temp_id) <span class="sc">|&gt;</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration =</span> <span class="fu">difftime</span>(<span class="fu">max</span>(time), <span class="fu">min</span>(time))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>duration <span class="sc">&lt;</span> <span class="dv">120</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(all_routes_seg<span class="sc">$</span>temp_id))</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Assining new segment_id starting at one, credits to: https://stackoverflow.com/questions/39650511/r-group-by-variable-and-then-assign-a-unique-id</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="ot">&lt;-</span> all_routes_seg <span class="sc">|&gt;</span> </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temp_id, messenger) <span class="sc">|&gt;</span> </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id =</span> <span class="fu">as_factor</span>(<span class="fu">cur_group_id</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>temp_id)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(all_routes_seg, <span class="at">file =</span> <span class="st">"rda_files/all_routes_seg.rda"</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="do">## how many segments have been differentiated?</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>all_routes_seg <span class="sc">|&gt;</span> </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(messenger) <span class="sc">|&gt;</span> </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">length</span>(<span class="fu">unique</span>(segment_id)))</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="do">## donner with 1162 deliveries</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="do">## raeubertochter with 1662 deliveries</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="do">## filter segments according to messenger</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>raeubertochter_seg <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes_seg, messenger <span class="sc">==</span> <span class="st">"raeubertochter"</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(raeubertochter_seg, <span class="at">file =</span> <span class="st">"rda_files/raeubertochter_seg.rda"</span>)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>donner_seg <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes_seg, messenger <span class="sc">==</span> <span class="st">"donner"</span>)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(donner_seg, <span class="at">file =</span> <span class="st">"rda_files/donner_seg.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-seg_data" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-seg_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-seg_data" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-raeubertochter_seg" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-raeubertochter_seg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/raeubertochter_seg.png" class="lightbox" data-gallery="fig-seg_data" title="Figure&nbsp;3&nbsp;(a): raeubertochter n = 22"><img src="figures/raeubertochter_seg.png" class="img-fluid figure-img" data-ref-parent="fig-seg_data"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-raeubertochter_seg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) raeubertochter n = 22
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-seg_data" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-donner_seg" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-donner_seg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/donner_seg.png" class="lightbox" data-gallery="fig-seg_data" title="Figure&nbsp;3&nbsp;(b): donner n = 36"><img src="figures/donner_seg.png" class="img-fluid figure-img" data-ref-parent="fig-seg_data"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-donner_seg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) donner n = 36
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-seg_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: segmented gps data from <code>raeubertochter</code> and <code>donner</code>
</figcaption>
</figure>
</div>
</section>
<section id="lost-in-transit-tackling-tunnel-gps-blackouts-for-bike-messenger" class="level3">
<h3 class="anchored" data-anchor-id="lost-in-transit-tackling-tunnel-gps-blackouts-for-bike-messenger">Lost in Transit: Tackling Tunnel GPS Blackouts for Bike Messenger</h3>
<p>In the analysis, we identified segments, that were incorrectly separated. The false separation was caused by the loss of the GPS signal in a bicycle tunnel between station Enge and the sports facility Sihlhölzli. The lost signal produced tracking intervals of more than 20 seconds and led to incorrect segmentation. In the following, we solve this problem using a spatial approach to reverse the incorrect segmentation.</p>
<ol type="1">
<li>The tunnel is located at the bottom half of <a href="#fig-raeubertochter_seg_context" class="quarto-xref">Figure&nbsp;4 (a)</a>. We see two segments (green / yellow), which were wrongfully separated as they represent the same delivery.</li>
<li>First we extracted the starting and endpoints of each delivery <a href="#fig-start_endpoints" class="quarto-xref">Figure&nbsp;4 (b)</a>. Additionally, a buffer around the entry and exit points of the tunnel was generated. We then overlaid the point feature with the tunnel buffer to identify segments with starting and endpoints near the tunnel <a href="#fig-overlay" class="quarto-xref">Figure&nbsp;4 (c)</a>.</li>
<li>Lastly we compared <code>segment_ids</code> of the identified delivery start- and endingpoints close to the tunnel. If an endpoint of <code>segment_id</code> <code>n</code> and a starting point of <code>segment_id</code> <code>n+1</code> were both within their respective buffer, a merge of segments was conducted <a href="#fig-merged" class="quarto-xref">Figure&nbsp;4 (d)</a>.</li>
</ol>
<p>For F1, two segments (<code>segment_id</code> 49 &amp; 50) were identified and merged back together.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## problem: we loose GPS signal in the bicycle tunnel from Enge to Sihlhölzli. Our segmentation splits the trajectories into two separate deliveries, even though it's the same route. We try to recognize split segments that we're falsely segmented:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>all_routes_seg_tunnel <span class="ot">&lt;-</span> all_routes_seg</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Create entry and exit points at the tunnel. For future project, there might be a data set with tunnel entities, where we could extract the entry and exit points automatically</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>tunnel_exit <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2682368</span>, <span class="dv">1246996</span>)), <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>tunnel_entry <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2682592</span>, <span class="dv">1246751</span>)), <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="do">## create a buffer around the tunnel entry and exit,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># tunnel_points &lt;- st_sfc(tunnel_entry, tunnel_exit, crs = 2056)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>buffer_entry <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(tunnel_entry, <span class="at">dist =</span> <span class="dv">50</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>buffer_exit <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(tunnel_exit, <span class="at">dist =</span> <span class="dv">50</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>segment_endpoints <span class="ot">&lt;-</span> all_routes_seg_tunnel <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment_id) <span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">start_point =</span> <span class="fu">first</span>(geometry), <span class="at">end_point =</span> <span class="fu">last</span>(geometry))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Check intersection with buffers</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>segment_endpoints <span class="ot">&lt;-</span> segment_endpoints <span class="sc">%&gt;%</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_in_entry_buffer =</span> <span class="fu">as.factor</span>(<span class="fu">st_intersects</span>(end_point, buffer_entry, <span class="at">sparse =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_in_exit_buffer =</span> <span class="fu">as.factor</span>(<span class="fu">st_intersects</span>(start_point, buffer_exit, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare adjacent segment IDs</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>matched_segments <span class="ot">&lt;-</span> segment_endpoints <span class="sc">|&gt;</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(segment_id) <span class="sc">|&gt;</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">same =</span> (end_in_entry_buffer <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">lead</span>(start_in_exit_buffer) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|</span> (start_in_exit_buffer <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">lag</span>(end_in_entry_buffer) <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter segments where endpoints are in the respective buffers and segment IDs follow each other</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>wrong_segments <span class="ot">&lt;-</span> matched_segments <span class="sc">|&gt;</span> </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(same <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment_id, same) <span class="sc">|&gt;</span> </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>wrong_segments<span class="sc">$</span>new_segment_id <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(wrong_segments), <span class="at">by =</span> <span class="dv">2</span>)) {</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  wrong_segments<span class="sc">$</span>new_segment_id[i<span class="sc">:</span>(i <span class="sc">+</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> wrong_segments<span class="sc">$</span>segment_id[i]</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="do">## create a table with falsely seperated segment_id's</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>lookup_table <span class="ot">&lt;-</span> wrong_segments <span class="sc">|&gt;</span> </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment_id, new_segment_id)  <span class="sc">|&gt;</span> </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co"># replace duplicates</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="do">## We recognized one falsely separated trajecotry. Segment 49 and 50 we're separated but should be kept together</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="do">## In this case, we could merge the segments back together manually. but with larger dataset, this might not be feasible. That's why we try a more general approach:</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="do">## create a lookup_vector based on our lookup_table. credits go to: https://stackoverflow.com/questions/35636315/replace-values-in-a-dataframe-based-on-lookup-</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="do">## This transforms the lookup table into a vector where the names are segment_id and the values are new_segment_id. This vector will be used to quickly find and replace old segment IDs with new ones.</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>lookup_vector <span class="ot">&lt;-</span> <span class="fu">setNames</span>(lookup_table<span class="sc">$</span>new_segment_id, lookup_table<span class="sc">$</span>segment_id)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="do">## match segment_id's with our lookup_vector. For each segment_id in all_routes_seg_tunnel, it checks if that ID is in the lookup vector. If it is, it replaces it with the corresponding new_segment_id from the lookup vector; if not, it keeps the original segment_id</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>all_routes_seg_tunnel<span class="sc">$</span>segment_id_new <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(all_routes_seg_tunnel<span class="sc">$</span>segment_id <span class="sc">%in%</span> <span class="fu">names</span>(lookup_vector), lookup_vector[<span class="fu">match</span>(all_routes_seg_tunnel<span class="sc">$</span>segment_id, <span class="fu">names</span>(lookup_vector))], all_routes_seg_tunnel<span class="sc">$</span>segment_id)</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="do">## tidy up our corrected dataframe</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>all_routes_seg_tunnel_cor <span class="ot">&lt;-</span> all_routes_seg_tunnel <span class="sc">|&gt;</span> </span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment_id_new, messenger) <span class="sc">|&gt;</span> </span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id_cor =</span> <span class="fu">as_factor</span>(<span class="fu">cur_group_id</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>segment_id, <span class="sc">-</span>segment_id_new) <span class="sc">|&gt;</span> </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="do">## How many deliveries after the correction?</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>all_routes_seg_tunnel_cor <span class="sc">|&gt;</span> </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(messenger) <span class="sc">|&gt;</span> </span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">length</span>(<span class="fu">unique</span>(segment_id_cor)))</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(all_routes_seg_tunnel_cor, <span class="at">file =</span> <span class="st">"rda_files/all_routes_seg_tunnel_cor.rda"</span>)</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="do">## donner with 1162 deliveries</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="do">## raeubertochter with 1657 deliveries</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="do">## seperate into raeubertochter and save for later visualization in preprocessing.qmd</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>raeubertochter_cor <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes_seg_tunnel_cor, messenger <span class="sc">==</span> <span class="st">"raeubertochter"</span>)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(raeubertochter_cor, <span class="at">file =</span> <span class="st">"rda_files/raeubertochter_cor.rda"</span>)</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a><span class="do">## and donner</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>donner_cor <span class="ot">&lt;-</span> <span class="fu">filter</span>(all_routes_seg_tunnel_cor, messenger <span class="sc">==</span> <span class="st">"donner"</span>)</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(donner_cor, <span class="at">file =</span> <span class="st">"rda_files/donner_cor.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-tunnel_workflow" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tunnel_workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tunnel_workflow" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-raeubertochter_seg_context" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-raeubertochter_seg_context-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/raeubertochter_seg_context.png" class="lightbox" data-gallery="fig-tunnel_workflow" title="Figure&nbsp;4&nbsp;(a): wrongfully segmented deliveries"><img src="figures/raeubertochter_seg_context.png" class="img-fluid figure-img" data-ref-parent="fig-tunnel_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-raeubertochter_seg_context-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) wrongfully segmented deliveries
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tunnel_workflow" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-start_endpoints" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-start_endpoints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/start_endpoints_context.png" class="lightbox" data-gallery="fig-tunnel_workflow" title="Figure&nbsp;4&nbsp;(b): extracting start and endpoints"><img src="figures/start_endpoints_context.png" class="img-fluid figure-img" data-ref-parent="fig-tunnel_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-start_endpoints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) extracting start and endpoints
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tunnel_workflow" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overlay" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-overlay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/overlay.png" class="lightbox" data-gallery="fig-tunnel_workflow" title="Figure&nbsp;4&nbsp;(c): overlay extracted points with tunnel entry/exit"><img src="figures/overlay.png" class="img-fluid figure-img" data-ref-parent="fig-tunnel_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-overlay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) overlay extracted points with tunnel entry/exit
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tunnel_workflow" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-merged" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-merged-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/merged.png" class="lightbox" data-gallery="fig-tunnel_workflow" title="Figure&nbsp;4&nbsp;(d): corrected segments"><img src="figures/merged.png" class="img-fluid figure-img" data-ref-parent="fig-tunnel_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-merged-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) corrected segments
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tunnel_workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: workflow to correct falsely separated segments
</figcaption>
</figure>
</div>
</section>
<section id="pedal-powered-possibilities-generating-alternative-trajectories" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="pedal-powered-possibilities-generating-alternative-trajectories">Pedal powered possibilities: Generating alternative trajectories</h3>
<p>We used the HERE API to generate alternative routes. The hereR<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> package provides an interface to the HERE REST APIs for R. The <code>route</code> function from the hereR package was used to generate alternative routes and enabled the calculation of a maximum of 7 alternative routes per original delivery. Based on the starting and endpoints <a href="#fig-original_route" class="quarto-xref">Figure&nbsp;5 (a)</a> of the corrected deliveries <code>route()</code> enables calculation of route geometries (LINESTRING) between given pairs of points <a href="#fig-alternatives" class="quarto-xref">Figure&nbsp;5 (b)</a>. Routes can be created for various transport modes, as for example car or bicycle. As this step needs a lot of time, the computation was transferred to <code>preprocessing.R</code>. The final result consist of the original route combined with one to seven alternative routes <a href="#fig-final_result" class="quarto-xref">Figure&nbsp;5 (c)</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternatives were created in prepocessing.qmd, a file called alternative_final.rda is stored in the global environment</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load alternatives</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"rda_files/alternative_final.rda"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify original dataframe</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>original <span class="ot">&lt;-</span> all_routes_seg_tunnel_cor <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(messenger, time, geometry, segment_id_cor) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">segment_id =</span> segment_id_cor) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">as.character</span>(<span class="st">"original"</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment_id =</span> <span class="fu">as.numeric</span>(segment_id)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify alternative datast</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>alternative <span class="ot">&lt;-</span> alternative_final <span class="sc">|&gt;</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment_id, rank,  geometry) <span class="sc">|&gt;</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">2056</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">as.character</span>(<span class="st">"alternative"</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment_id =</span> <span class="fu">as.numeric</span>(segment_id),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">as.numeric</span>(rank)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#combine the dataset</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(original, alternative)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in missing messenger values</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> combined <span class="sc">|&gt;</span> </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(segment_id, messenger) <span class="sc">|&gt;</span> </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(messenger, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>combined<span class="sc">$</span>rank[<span class="fu">is.na</span>(combined<span class="sc">$</span>rank)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Save combined dataset for visualizations in preprocessing.qmd</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(combined, <span class="at">file =</span> <span class="st">"rda_files/combined.rda"</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="do">### As our access to the here API was limited, we were only able to generate a set of alternatives for the shift F1.</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="do">## As mentioned above, we have the problem, that we only had limited access to the here API. Therefore we do not have an alternative for every single original trajectory. Before continuoing with our calculations, we need to filter the segments that each have an original route and an alternative</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="do">## get every unique segment id from the type original</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>original_ids <span class="ot">&lt;-</span> combined <span class="sc">|&gt;</span> </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">'original'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(segment_id) <span class="sc">|&gt;</span> </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="do">## get every unique segment id from the type alternative</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>alternative_ids <span class="ot">&lt;-</span> combined <span class="sc">|&gt;</span>  </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">'alternative'</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(segment_id) <span class="sc">|&gt;</span> </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="do">## Find common segment_ids, how many segments are there?</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>common_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(original_ids, alternative_ids)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(common_ids))</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Latest computation: 50 matching segments</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter the dataframe</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> combined <span class="sc">|&gt;</span> </span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(segment_id <span class="sc">%in%</span> common_ids)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="co"># We have a very uneven distribution of gps fixes, a problem we'll solve later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-alternative_workflow" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-alternative_workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-alternative_workflow" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-original_route" class="lightbox quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-original_route-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="figures/original_route_start_endpoints.png" class="lightbox page-columns page-full" data-gallery="fig-alternative_workflow" title="Figure&nbsp;5&nbsp;(a): original route by donner"><img src="figures/original_route_start_endpoints.png" class="img-fluid figure-img column-page" data-ref-parent="fig-alternative_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-original_route-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) original route by donner
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-alternative_workflow" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-alternatives" class="lightbox quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-alternatives-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="figures/alternative_routing.png" class="lightbox page-columns page-full" data-gallery="fig-alternative_workflow" title="Figure&nbsp;5&nbsp;(b): computed alternates using here API"><img src="figures/alternative_routing.png" class="img-fluid figure-img column-page" data-ref-parent="fig-alternative_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-alternatives-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) computed alternates using here API
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-alternative_workflow" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-final_result" class="lightbox quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-final_result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="figures/final_result.png" class="lightbox page-columns page-full" data-gallery="fig-alternative_workflow" title="Figure&nbsp;5&nbsp;(c): original and alternative routes combined"><img src="figures/final_result.png" class="img-fluid figure-img column-page" data-ref-parent="fig-alternative_workflow"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-final_result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) original and alternative routes combined
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-alternative_workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: creating alternative routes based on the start and endpoints of the original routes
</figcaption>
</figure>
</div>
</section>
<section id="map-matching-fixing-gps-points-to-an-existing-road-network" class="level3">
<h3 class="anchored" data-anchor-id="map-matching-fixing-gps-points-to-an-existing-road-network">Map Matching: Fixing gps points to an existing road network</h3>
<p>Map matching denotes the process of assigning positional data (mostly in form of GPS coordinates) to some geographic information about the infrastructure, most commonly road networks <span class="citation" data-cites="meister_descriptive_2021">(<a href="#ref-meister_descriptive_2021" role="doc-biblioref">Meister, Gupta, and Axhausen 2021</a>)</span>. In our map matching process, we used distance-based matching of a point to a road which return the edges that are closest to the trajectory. Geometrically we unified all roads into a single network. We then located the nearest point on this network for each GPS location and used these coordinates to update the original GPS locations, effectively mapping each GPS point to its closest location on the road network.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## since we want to find the closest location on the road over ALL roads</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## we need to create a union of the roads first.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>street_network <span class="ot">&lt;-</span> <span class="fu">st_union</span>(streets)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can get the nearest point for each GPS location</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">&lt;-</span> <span class="fu">st_nearest_points</span>(filtered_df, street_network)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(nearest, <span class="at">file =</span> <span class="st">"rda_files/nearest.rda"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is a line for each point</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we need convert the output from LINE to POINT. </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This doubles the number of features</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>near_p <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(nearest, <span class="st">"POINT"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># now we subset the points. Even numbers are the new, mapmatched points.</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>near_to <span class="ot">&lt;-</span> near_p[<span class="fu">c</span>(<span class="cn">FALSE</span>,<span class="cn">TRUE</span>)]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the geometry of the original points with the new map matched locations</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(filtered_df) <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(near_to)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(filtered_df, <span class="at">file =</span> <span class="st">"rda_files/filtered_df.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-mapmatching" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapmatching-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/map_matching.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;6: Map matched gps points (old coordinates / updated coordinates)"><img src="figures/map_matching.png" id="fig-map_matching" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mapmatching-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Map matched gps points (<span style="color:orange;">old coordinates</span> / <span style="color:#9E1FA2;">updated coordinates</span>)
</figcaption>
</figure>
</div>
</section>
<section id="data-granularity-uneven-distribution-of-data-points" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="data-granularity-uneven-distribution-of-data-points">Data granularity: Uneven distribution of data points</h3>
<p>We encountered a challenge due to the unequal distribution of data points / granularity within original routes and alternative routes <a href="#fig-uneven" class="quarto-xref">Figure&nbsp;7</a>. As derived movement parameters are strongly influenced by the sampling rate, uneven amount of data points can skew calculations due to smaller intervals (more fixes) in original routes detecting more differences in height or slope than wider intervals in alternative routing <span class="citation" data-cites="laube_how_2011">(<a href="#ref-laube_how_2011" role="doc-biblioref">Laube and Purves 2011</a>)</span>. Currently, there are often twice as many data points in our <span style="color:#9E1FA2;">original</span> segments (rank = 0) than the <span style="color:#11E2A1;">alternatives</span> (rank 1 to 7).</p>

<div class="no-row-height column-margin column-container"><div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We encounter the problem, that our alternative routes consist of two to three times less data points as our original routes. The denser sampling intervals in our original routes could lead to uneven calculations. For example, smaller intervals could detect more differences in height/slope than the wider sampling interval in the alternative routing</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## how many fixes?</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>overview <span class="ot">&lt;-</span> filtered_df <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">count2 =</span> <span class="fu">n_distinct</span>(segment_id)) <span class="sc">|&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">as.factor</span>(type),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">as.numeric</span>(count)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>overview <span class="ot">&lt;-</span> overview <span class="sc">|&gt;</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, messenger, count, rank) <span class="sc">|&gt;</span> </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(overview, <span class="at">file =</span> <span class="st">"rda_files/overview.rda"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>overview <span class="sc">|&gt;</span> </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, rank) <span class="sc">|&gt;</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(count)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   type [2]
  type         rank  mean
  &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 alternative     1  75.7
2 alternative     2  81.3
3 alternative     3  84.5
4 alternative     4  92.8
5 alternative     5 103. 
6 alternative     6 109. 
7 alternative     7 103. 
8 original        0 178. </code></pre>
</div>
</div></div><div id="fig-uneven" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uneven-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/uneven.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;7: Uneven distribution of gps points in original vs.&nbsp;alternative routes"><img src="figures/uneven.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uneven-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Uneven distribution of gps points in original vs.&nbsp;alternative routes
</figcaption>
</figure>
</div>
</section>
<section id="interpolation-computing-points-along-trajectories" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="interpolation-computing-points-along-trajectories">Interpolation: Computing points along trajectories</h3>
<p>To solve the issue of uneven amounts of data points, we interpolated points along the trajectories. We simplified the dataset, transformed it into a linestring, and created an interpolation function. We then applied this function to each linestring, resulting in a new point every 10 meters on the trajectory. As we can see in <a href="#fig-interpolation" class="quarto-xref">Figure&nbsp;8</a>, the interpolation resulted in an even distribution of data points between <span style="color:#11E2A1;">alternative</span> and <span style="color:#9E1FA2;">original</span> routes.</p>

<div class="no-row-height column-margin column-container"><div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Because of the uneven distribution, we decided to interpolate along the original and alternative trajectories</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify dataset</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> <span class="fu">select</span>(filtered_df, <span class="sc">-</span>time)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">## transform the combined dataset into a linestring. The interpolation will follow these linestrings later</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>df_lines2 <span class="ot">&lt;-</span> filtered_df <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_combine</span>(geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="do">## interpolating</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="do">## creating a function to interpolate points along lines, there are several functions for interpolation like st_line_sample, sp_sample or gInterpolate by rgeos. </span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>interpolate_points <span class="ot">&lt;-</span> <span class="cf">function</span>(geometry, <span class="at">dist=</span><span class="dv">10</span>) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">st_length</span>(geometry) <span class="co"># how long is the line?</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  n_points <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(len <span class="sc">/</span> dist) <span class="co"># how many points will be sampled -&gt; tot_length / distance between points</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_line_sample</span>(geometry, <span class="at">sample =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_points)) <span class="co"># sequence between 0 and 1 indicating how many points will be sampled based on the length.out = n_points which represents how many points will be sampled</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each LINESTRING</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># purrr::map: This is a function from the purrr package. The map function applies a function to each element of a list or vector and returns a list. Credits go to Nils ;)</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>df_lines2<span class="sc">$</span>points <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(df_lines2<span class="sc">$</span>geometry, interpolate_points)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Unnest the points</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>df_points <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">unnest</span>(df_lines2, points)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="do">## create linestring out of interpolated points for later visualizations</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>df_lines_interp <span class="ot">&lt;-</span> df_points <span class="sc">|&gt;</span> </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>(points)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="do">## remove LINEGEOMETRY</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>df_points <span class="ot">&lt;-</span> df_points <span class="sc">|&gt;</span> </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>(geometry)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="do">## cast POINTGEOMETRY</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>df_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df_points)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="do">## Use st_cast to convert multipoint to single point</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>df_single_points <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(df_sf, <span class="st">"POINT"</span>)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="do">## somehow have troubles with the geometries, try to solve it:</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>df_single_points <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(df_single_points, <span class="dv">2056</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>df_single_points <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(df_single_points, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_single_points, <span class="at">file =</span> <span class="st">"rda_files/df_single_points.rda"</span>)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="do">## how many fixes for alternative / original?</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="do">## our interpolation generated a dataset with a even distribution between alternatives and originals routes:</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>df_single_points <span class="sc">|&gt;</span> </span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rank) <span class="sc">|&gt;</span> </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_segments =</span> <span class="fu">n_distinct</span>(segment_id),</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">fix_per_rank =</span> n <span class="sc">/</span> n_segments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 8 features and 4 fields
Geometry type: MULTIPOINT
Dimension:     XY
Bounding box:  xmin: 2678855 ymin: 1245760 xmax: 2684004 ymax: 1249924
Projected CRS: CH1903+ / LV95
# A tibble: 8 × 5
   rank     n n_segments fix_per_rank                                     points
  &lt;dbl&gt; &lt;int&gt;      &lt;int&gt;        &lt;dbl&gt;                           &lt;MULTIPOINT [m]&gt;
1     0 10467         57         184. ((2678855 1249215), (2678863 1249209), (2…
2     1 10522         57         185. ((2678856 1249214), (2678864 1249208), (2…
3     2  9903         50         198. ((2678856 1249214), (2678864 1249208), (2…
4     3  9865         47         210. ((2678856 1249214), (2678864 1249208), (2…
5     4  8775         38         231. ((2678884 1248014), (2678884 1248024), (2…
6     5  7944         32         248. ((2678884 1248013), (2678884 1248023), (2…
7     6  6385         25         255. ((2678948 1247525), (2678950 1247534), (2…
8     7  5243         21         250. ((2678948 1247525), (2678950 1247535), (2…</code></pre>
</div>
</div></div><div id="fig-interpolation" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interpolation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-interpolation" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-problem" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-problem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/problem.png" class="lightbox" data-gallery="fig-interpolation" title="Figure&nbsp;8&nbsp;(a): uneven amount of data points"><img src="figures/problem.png" class="img-fluid figure-img" data-ref-parent="fig-interpolation"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-problem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) uneven amount of data points
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-interpolation" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-problem_solved" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-problem_solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/problem_solved.png" class="lightbox" data-gallery="fig-interpolation" title="Figure&nbsp;8&nbsp;(b): even amount of data points"><img src="figures/problem_solved.png" class="img-fluid figure-img" data-ref-parent="fig-interpolation"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-problem_solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) even amount of data points
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interpolation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Difference between raw dataset (a) and interpolated version of messenger movement data (b)
</figcaption>
</figure>
</div>
<p>In a final step, we enriched messenger movement data with spatial data like height difference, street width, slope and segment length.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We work with 52 trajectories (donner: 33 / raeubertochter: 19)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Enrich combined dataset with street and environmental data</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">## buffer point features to intersect them with the street network</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>traj <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(df_single_points, <span class="fl">0.5</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="do">## set crs for polygon layer</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>traj <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(traj, <span class="dv">2056</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">## intersect polygon with street network</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>traj_width <span class="ot">&lt;-</span> <span class="fu">st_join</span>(traj, streets, <span class="at">left =</span> <span class="cn">TRUE</span>, <span class="at">suffix =</span> <span class="st">"street"</span>, <span class="at">join =</span> st_intersects)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="do">## transfrom back to a point layer</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>traj_width <span class="ot">&lt;-</span>  <span class="fu">st_centroid</span>(traj_width, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Fill missing width's in dataframe</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>traj_width <span class="ot">&lt;-</span> traj_width <span class="sc">|&gt;</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(objektart, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(width, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract height at every point using dhm25</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>extracted_height <span class="ot">&lt;-</span> <span class="fu">extract</span>(height, traj_width)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>traj_width<span class="sc">$</span>height <span class="ot">&lt;-</span> <span class="fu">round</span>(extracted_height<span class="sc">$</span>dhm25_zh,<span class="dv">2</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract slope at every point</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">terrain</span>(height, <span class="at">v =</span> <span class="st">"slope"</span>, <span class="at">unit =</span> <span class="st">"degrees"</span>, <span class="at">neighbors =</span> <span class="dv">8</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>extracted_slope <span class="ot">&lt;-</span> <span class="fu">extract</span>(slope, traj_width)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>traj_width<span class="sc">$</span>slope <span class="ot">&lt;-</span> <span class="fu">round</span>(extracted_slope<span class="sc">$</span>slope,<span class="dv">2</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify dataframe</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>traj_enriched <span class="ot">&lt;-</span> traj_width <span class="sc">|&gt;</span> </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>objektart)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculations between a pair of points</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>traj_enriched_final <span class="ot">&lt;-</span> traj_enriched <span class="sc">|&gt;</span> </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lead_geom =</span> <span class="fu">lead</span>(points),</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">travel_dist =</span> <span class="fu">sqrt</span>(<span class="fu">round</span>(<span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(lead_geom), <span class="fu">st_distance</span>(lead_geom, points, <span class="at">by_element =</span> <span class="cn">TRUE</span>), <span class="dv">0</span>), <span class="dv">1</span>))<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_cumulative =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(travel_dist <span class="sc">&gt;</span> <span class="dv">0</span>, travel_dist, <span class="dv">0</span>)), </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_segment_length =</span> <span class="fu">max</span>(dist_cumulative, <span class="at">na.rm =</span> T),</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(height)),</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_height_up =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(height_diff <span class="sc">&gt;</span> <span class="dv">0</span>, height_diff, <span class="dv">0</span>)),</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_height_down =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(height_diff <span class="sc">&lt;</span> <span class="dv">0</span>, height_diff, <span class="dv">0</span>)),</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_calc =</span> <span class="fu">ifelse</span>(travel_dist <span class="sc">!=</span> <span class="dv">0</span>, (height_diff <span class="sc">/</span> travel_dist)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Analysing result</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>false <span class="ot">&lt;-</span> traj_enriched_final <span class="sc">|&gt;</span> </span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(segment_id <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> type <span class="sc">==</span> <span class="st">"original"</span>, travel_dist <span class="sc">&lt;</span> <span class="fl">4.01</span>)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>blabla <span class="ot">&lt;-</span> traj_enriched_final <span class="sc">|&gt;</span> </span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(segment_id <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> type <span class="sc">==</span> <span class="st">"original"</span>, travel_dist <span class="sc">&gt;</span> <span class="dv">5</span>) </span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>haha <span class="ot">&lt;-</span> df_lines2 <span class="sc">|&gt;</span> </span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(segment_id <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> type <span class="sc">==</span> <span class="st">"original"</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(false) <span class="sc">+</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"gold"</span>, <span class="at">size =</span> <span class="fl">0.15</span>)<span class="sc">+</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(blabla) <span class="sc">+</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"travel_dist"</span>) <span class="sc">+</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(haha) <span class="sc">+</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>()</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="do">## somehow the interpolation did not work as expected, there are some overlaying points resulting in a travel_dist of 0.. also euclid distance results in travel_dist shorter than 10m because of turning angles.. we clean the dataset as follows:</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.) remove poits with a euclid distance of &lt; 4.5m</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.) set travel dist to 10m manually</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="do">## Cleaning</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>traj_cleaned <span class="ot">&lt;-</span> traj_enriched_final <span class="sc">|&gt;</span> </span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>travel_dist <span class="sc">&lt;</span> <span class="fl">4.5</span>) </span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat calculations</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> traj_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lead_geom =</span> <span class="fu">lead</span>(points),</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">travel_dist =</span> <span class="fu">sqrt</span>(<span class="fu">round</span>(<span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(lead_geom), <span class="fu">st_distance</span>(lead_geom, points, <span class="at">by_element =</span> <span class="cn">TRUE</span>), <span class="dv">0</span>), <span class="dv">1</span>))<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_cumulative =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(travel_dist <span class="sc">&gt;</span> <span class="dv">0</span>, travel_dist, <span class="dv">0</span>)), </span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_segment_length =</span> <span class="fu">max</span>(dist_cumulative, <span class="at">na.rm =</span> T),</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(height)),</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_height_up =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(height_diff <span class="sc">&gt;</span> <span class="dv">0</span>, height_diff, <span class="dv">0</span>)),</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_height_down =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(height_diff <span class="sc">&lt;</span> <span class="dv">0</span>, height_diff, <span class="dv">0</span>)),</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_calc =</span> <span class="fu">ifelse</span>(travel_dist <span class="sc">!=</span> <span class="dv">0</span>, (height_diff <span class="sc">/</span> travel_dist)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>)</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a><span class="co"># setting travel distance to 10m manually, traveled distance was 10m on the line, so euclidiean distance is a little useless here..</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>new<span class="sc">$</span>travel_dist <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculations over a moving window of 100m (travel distance, 10 points)</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="do">## Indexing 100m segments</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(type, messenger, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="fu">as.integer</span>(<span class="fu">cumsum</span>(travel_dist) <span class="sc">/</span> <span class="fl">100.1</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a><span class="do">## Transform certain columns</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">as.factor</span>(type),</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment_id =</span> <span class="fu">as.factor</span>(segment_id),</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">as.factor</span>(rank),</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="fu">as.factor</span>(index),</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fu">as.factor</span>(width)</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="do">## Height differences over first and last point of 100m segments</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(type, messenger, segment_id, rank, index) <span class="sc">|&gt;</span> </span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>   <span class="at">height_diff_100 =</span> <span class="fu">last</span>(height) <span class="sc">-</span> <span class="fu">first</span>(height),</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>   <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>alternative_final <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"alternative"</span>)</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>original_final <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"original"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="results" class="level1 page-columns page-full">
<h1>Results</h1>
<section id="descriptive-analysis" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-analysis">Descriptive Analysis</h3>
<p>As shown in <a href="#tbl-letters" class="quarto-xref">Table&nbsp;1</a>, the original routes are on average shorter compared to the alternatives. With an average segment length of 2229 meters, 385 meters are <em>saved</em> per delivery. The longest original segment in Shift <code>F1</code> is a delivery of 4039 meters.</p>
<p>For height_up and height_down, cumulative elevation differences between points were calculated, with positive values summarized in height_up and the negative values summarized in height_down. The elevation differences are comparable for both types (original and alternative), with alternatives handling about 4.7 meters more in elevation gain/loss per segment.</p>
<p>To compare the slope between the two types, all trajectories were divided into subsegments of 100 meters in length. Subsequently, average and maximum slope in these subsegments were calculated for every delivery. The average slope in these subsegments is 0.03% for originals and 0.02% for alternatives. The steepest 100-meter subsegment was driven in an original segment and reached 12.3%.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive analysis - segment length</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>new <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">Minimum =</span> <span class="fu">min</span>(tot_segment_length), <span class="at">Mittelwert =</span> <span class="fu">mean</span>(tot_segment_length), <span class="at">Maximum =</span> <span class="fu">max</span>(tot_segment_length)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            , <span class="at">Standardabweichung =</span> <span class="fu">sd</span>(tot_segment_length), <span class="at">Bereich =</span> (<span class="fu">max</span>(tot_segment_length)<span class="sc">-</span><span class="fu">min</span>(tot_segment_length)), <span class="fu">median</span>(tot_segment_length))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive analysis - height up</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>new <span class="sc">|&gt;</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Minimum =</span> <span class="fu">min</span>(tot_height_up), <span class="at">Mittelwert =</span> <span class="fu">mean</span>(tot_height_up),  <span class="at">Maximum =</span> <span class="fu">max</span>(tot_height_up)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            , <span class="at">Standardabweichung =</span> <span class="fu">sd</span>(tot_height_up), <span class="at">Bereich =</span> (<span class="fu">max</span>(tot_height_up)<span class="sc">-</span><span class="fu">min</span>(tot_height_up)), <span class="fu">median</span>(tot_height_up))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive analysis - height down</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>new <span class="sc">|&gt;</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(, <span class="at">Minimum =</span> <span class="fu">min</span>(tot_height_down), <span class="at">Mittelwert =</span> <span class="fu">mean</span>(tot_height_down), <span class="at">Maximum =</span> <span class="fu">max</span>(tot_height_down)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            , <span class="at">Standardabweichung =</span> <span class="fu">sd</span>(tot_height_down), <span class="at">Bereich =</span> (<span class="fu">max</span>(tot_height_down)<span class="sc">-</span><span class="fu">min</span>(tot_height_down)), <span class="fu">median</span>(tot_height_down))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(new, <span class="at">file =</span> <span class="st">"rda_files/new.rda"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="do">## summarise values over 100m subsegments</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> new <span class="sc">%&gt;%</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, index) <span class="sc">%&gt;%</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">slope_down =</span> <span class="fu">mean</span>(<span class="fu">ifelse</span>(slope_calc <span class="sc">&lt;</span> <span class="dv">0</span>, slope_calc, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">slope_up =</span> <span class="fu">mean</span>(<span class="fu">ifelse</span>(slope_calc <span class="sc">&gt;</span> <span class="dv">0</span>, slope_calc, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">max_slope =</span> <span class="fu">max</span>((slope_calc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_slope =</span> <span class="fu">min</span>((slope_calc),<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_slope =</span> <span class="fu">mean</span>((slope_calc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">mean_slope100 =</span> <span class="fu">mean</span>((height_diff_100 <span class="sc">/</span> (n<span class="sc">*</span><span class="dv">10</span>))) <span class="sc">*</span><span class="dv">100</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Mean of 'value' column per group</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive analysis - average and max. slopes over 100m sub segments</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">meanMittelwert =</span> <span class="fu">mean</span>(mean_slope100), <span class="at">meanMinimum =</span> <span class="fu">min</span>(mean_slope100), <span class="at">meanMaximum =</span> <span class="fu">max</span>(mean_slope100),</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">meanMax100 =</span> <span class="fu">mean</span>(max_slope),</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">maxMax100 =</span> <span class="fu">max</span>(max_slope), </span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">minMin =</span> <span class="fu">min</span>(max_slope))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tbl-letters" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-letters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Comparison of original and alternative routes
</figcaption>
<div aria-describedby="tbl-letters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">original</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">alternative</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>variable</td>
<td style="text-align: center;">unit</td>
<td style="text-align: center;">min</td>
<td style="text-align: center;">mean</td>
<td style="text-align: center;">max</td>
<td style="text-align: center;">min</td>
<td style="text-align: center;">mean</td>
<td style="text-align: center;">max</td>
</tr>
<tr class="even">
<td>travel distance</td>
<td style="text-align: center;">[m]</td>
<td style="text-align: center;">584</td>
<td style="text-align: center;">2229</td>
<td style="text-align: center;">4039</td>
<td style="text-align: center;">360</td>
<td style="text-align: center;">2614</td>
<td style="text-align: center;">4640</td>
</tr>
<tr class="odd">
<td>average gradient per 100m</td>
<td style="text-align: center;">[%]</td>
<td style="text-align: center;">-8.88</td>
<td style="text-align: center;">0.03</td>
<td style="text-align: center;">12.3</td>
<td style="text-align: center;">-5.98</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td>max. + gradient per 100m</td>
<td style="text-align: center;">[%]</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">4.12</td>
<td style="text-align: center;">75.0</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">7.86</td>
<td style="text-align: center;">76.6</td>
</tr>
<tr class="odd">
<td>height up</td>
<td style="text-align: center;">[m]</td>
<td style="text-align: center;">0.68</td>
<td style="text-align: center;">20.5</td>
<td style="text-align: center;">87.7</td>
<td style="text-align: center;">0.78</td>
<td style="text-align: center;">25.2</td>
<td style="text-align: center;">113</td>
</tr>
<tr class="even">
<td>height down</td>
<td style="text-align: center;">[m]</td>
<td style="text-align: center;">-0.25</td>
<td style="text-align: center;">-20.2</td>
<td style="text-align: center;">-89.3</td>
<td style="text-align: center;">-0.38</td>
<td style="text-align: center;">-24.9</td>
<td style="text-align: center;">-138</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="segment-length" class="level3">
<h3 class="anchored" data-anchor-id="segment-length">Segment length</h3>
<p>Next, we took a closer look at the segment lengths. The segment length of the original routes varies between messengers <a href="#fig-segment_length_messenger" class="quarto-xref">Figure&nbsp;9</a>. On average, a delivery by <code>raeubertochter</code> was 2025 meters, while deliveries conducted by <code>donner</code> were 1647 meters long. However, the differences in segment length between the messengers proved to be not significant (t-test, p = 0.166, t = 1.418, df = 32).</p>
<div id="fig-segment_length_messenger" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-segment_length_messenger-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/seg_length.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;9: Difference in segment lengths by messengers"><img src="figures/seg_length.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-segment_length_messenger-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Difference in segment lengths by messengers
</figcaption>
</figure>
</div>
<p>For each original delivery, between 1 and 7 alternatives were generated. We then examined whether there were differences in segment length between the original routes and alternatives 1 to 7. Among the 57 segments analyzed, the original route was the shortest route in 24 instances, representing 42.1% (compared to all alternatives).</p>
<p>As we can see from the figure <a href="#fig-anova" class="quarto-xref">Figure&nbsp;10</a>, there are differences in segment length between the original and the individual alternatives. However, the pairwise comparison between the original and alternatives 1 to 7 did not reveal any significant differences. It shows that the first alternative (A1) to the original route is the closest in terms of segment length <a href="#fig-shortest" class="quarto-xref">Figure&nbsp;11</a>, with a mean difference of only 43.76 meters (paired t-test, p = 0.193, t = 1.3168, df = 56). The differences in segment length become more pronounced as the number of alternatives increases.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Are there differences between shortest route generated and route choosen?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>comparison1 <span class="ot">&lt;-</span> df_spread <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> rank <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tot_travel)) <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> rank, <span class="at">value =</span> mean) <span class="sc">|&gt;</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"original"</span> <span class="ot">=</span> <span class="st">"0"</span> , <span class="st">"alternative1"</span> <span class="ot">=</span> <span class="st">"1"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(comparison1<span class="sc">$</span>alternative1, comparison1<span class="sc">$</span>original, <span class="at">paired =</span> T)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate percentage of shortest route messengers vs. alternatives</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>comparison2 <span class="ot">&lt;-</span> df_spread <span class="sc">|&gt;</span> </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment_id) <span class="sc">|&gt;</span> </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">shorter =</span> <span class="fu">min</span>(tot_travel[rank <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">&lt;</span> <span class="fu">min</span>(tot_travel[rank <span class="sc">!=</span> <span class="dv">0</span>]))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>shorter_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(comparison2<span class="sc">$</span>shorter)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the total number of unique segment_ids</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>total_segments <span class="ot">&lt;-</span> <span class="fu">nrow</span>(comparison2)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the percentage</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>percentage <span class="ot">&lt;-</span> (shorter_count <span class="sc">/</span> total_segments) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="do">## alternatives and originals almost 50/50. But original mean tot_segment_length 100m shorter than alternative. Alternative routing based on shortest routes... </span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># mean difference between original route and shortest generated route at 43m</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># in 42% of the times, original was still shortest! so basically no difference between shortest route generated and choosen route!</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># So we see slight difference between messengers, but also that alternatives and originals differ.</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="do">## But what about rank's? Do more alternatives make sense? or do they change output?</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">=</span> <span class="fu">aov</span>(tot_travel <span class="sc">~</span> rank, <span class="at">data =</span> df_spread)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow = c(2, 2))</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(lm)</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(lm)  </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(lm)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="fu">HSD.test</span>(lm, <span class="st">"rank"</span>, <span class="at">console=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co"># significant anova overall, but no pairwise difference between ranks</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ANOVA is significant, but no pairwise difference recognised, Original vs. A5 almost significant. Trend is here, with every alternative, segment_length() gets longer..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-anova" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/anova.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;10: Difference in segment lengths by original routes and all alternatives"><img src="figures/anova.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Difference in segment lengths by original routes and all alternatives
</figcaption>
</figure>
</div>
<div id="fig-shortest" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-shortest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/shortest.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;11: Difference in segment lengths by original and shortest alternative A1"><img src="figures/shortest.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-shortest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Difference in segment lengths by original and shortest alternative A1
</figcaption>
</figure>
</div>
</section>
<section id="street-width" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="street-width">Street width</h3>
<p>Next, we investigated whether certain types of streets were preferred by messengers based on street width. Since there is no clear procedure for evaluating preferences, we developed an own approach. In each segment, we calculated the share of the different street widths (1, 2, 3, 4, 6, and 8 meters wide) in contrast to the segment length. For each segment (original and alternative) we get percentages on how much a certain street width was used. We then combined the calculated percentage values for all alternatives per segment. For each segment, we obtained a single alternative that summarizes the shares based on street width. The output tibble shows alternative 1 of segment 1 with its street width percentages. This average alternative can then be compared with the actual route taken by the messengers. We then subtracted original percentages from the average alternative percentages to estimate <em>preference</em>.</p>
<p>This approach reveals clear preferences or aversions among three street widths. Narrow streets (1 meter wide) are clearly avoided by bike messengers compared to the average alternative, while street widths of two to three meters are clearly preferred <a href="#fig-preference" class="quarto-xref">Figure&nbsp;12</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize enriched network for street width</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>width_preference <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, rank, width) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum =</span> <span class="fu">sum</span>(travel_dist, <span class="at">na.rm =</span> T)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">##Create a complete set of segment IDs and street widths, credits go to: https://stackoverflow.com/questions/73717164/create-all-combinations-of-two-variables-from-two-dataframes-while-keeping-all-o</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>complete_set <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">segment_id =</span> <span class="fu">unique</span>(width_preference<span class="sc">$</span>segment_id),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">rank =</span> <span class="fu">unique</span>(width_preference<span class="sc">$</span>rank),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">width =</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>)),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type =</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="st">"original"</span>, <span class="st">"alternative"</span>)))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                           <span class="co">#messenger = as.factor(c("raeubertochter", "donner")))</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create a complete set of street widths</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>complete_set <span class="ot">&lt;-</span> complete_set <span class="sc">|&gt;</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(type <span class="sc">==</span> <span class="st">"original"</span> <span class="sc">&amp;</span> rank <span class="sc">!=</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(type <span class="sc">==</span> <span class="st">"alternative"</span> <span class="sc">&amp;</span> rank <span class="sc">==</span> <span class="dv">0</span>)) </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="do">##Left join this set with  original data frame</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>complete_df <span class="ot">&lt;-</span>  <span class="fu">full_join</span>(complete_set, width_preference, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"type"</span>,<span class="st">"segment_id"</span>, <span class="st">"rank"</span>, <span class="st">"width"</span>))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Replace NA values with 0</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>complete_df[<span class="fu">is.na</span>(complete_df)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># a complete set was generated, for every segment, type and rank, shared street widths were calculated</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>width_preference2 <span class="ot">&lt;-</span> complete_df <span class="sc">|&gt;</span> </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(type, segment_id, rank) <span class="sc">|&gt;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> width,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum =</span> <span class="fu">as.numeric</span>(sum),</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">tot =</span> <span class="fu">sum</span>(sum),</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">perc =</span> (sum <span class="sc">/</span> tot) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>width_preference2 <span class="ot">&lt;-</span> width_preference2 <span class="sc">|&gt;</span> </span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(type, segment_id, rank) <span class="sc">|&gt;</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_tot =</span> <span class="fu">sum</span>(perc)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>choice_avg <span class="ot">&lt;-</span> width_preference2 <span class="sc">|&gt;</span> </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(type, segment_id, width) <span class="sc">|&gt;</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean_perc =</span> <span class="fu">mean</span>(perc)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>all_together <span class="ot">&lt;-</span> choice_avg <span class="sc">|&gt;</span> </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, width) <span class="sc">|&gt;</span> </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean_perc =</span> <span class="fu">mean</span>(mean_perc)</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>spread <span class="ot">&lt;-</span> <span class="fu">spread</span>(all_together, <span class="at">key =</span> type, <span class="at">value =</span> mean_perc)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co"># do original routes differ from averaged alternatives?</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>spread<span class="sc">$</span>diff <span class="ot">&lt;-</span> spread<span class="sc">$</span>original <span class="sc">-</span> spread<span class="sc">$</span>alternative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> width_preference2 <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(segment_id <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> rank <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
# Groups:   type, segment_id, rank [1]
  segment_id rank  width type          sum     n   tot  perc sum_tot
  &lt;fct&gt;      &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 1          1     1     alternative  1420     6  4110  34.5     100
2 1          1     2     alternative     0     6  4110   0       100
3 1          1     3     alternative     0     6  4110   0       100
4 1          1     4     alternative  1020     6  4110  24.8     100
5 1          1     6     alternative   990     6  4110  24.1     100
6 1          1     8     alternative   680     6  4110  16.5     100</code></pre>
</div>
</div></div><div id="fig-preference" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-preference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/preference.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;12: Preferred street widths by messengers compared to average street widths of all alternatives"><img src="figures/preference.png" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-preference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Preferred street widths by messengers compared to average street widths of all alternatives
</figcaption>
</figure>
</div>
</section>
<section id="slope" class="level3">
<h3 class="anchored" data-anchor-id="slope">Slope</h3>
<p>Lastly, we analyzed how slope differs between original and alternative routes. Similar to <span class="citation" data-cites="broach2012cyclists">Broach, Dill, and Gliebe (<a href="#ref-broach2012cyclists" role="doc-biblioref">2012</a>)</span>, we categorized all 100m subsegments into three different slope categories of 2-4%, 4-6% and &gt;6%. We then calculated mean counts per trajectory to see, if the amount of subsegments within the categories differ between original and alternative routes. We see, that the categories differ slightly (e.g.&nbsp;2-4% and &gt;6%), but no real difference between original and alternative routes can be distinguished <a href="#fig-slope_cat" class="quarto-xref">Figure&nbsp;13</a>. However, there is a marginal trend to higher amounts of steep subsegments in original routes visible.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># max averae slope per 100m</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mean average_slope per 100m</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># counts per category / m per categor</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> new <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, rank, index) <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">mean_slope_up =</span> <span class="fu">mean</span>(<span class="fu">ifelse</span>(slope_calc <span class="sc">&gt;</span> <span class="dv">0</span>, slope_calc, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_slope_up =</span> <span class="fu">max</span>(<span class="fu">ifelse</span>(slope_calc <span class="sc">&gt;</span> <span class="dv">0</span>, slope_calc, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_slope =</span> <span class="fu">mean</span>((slope_calc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">max_slope =</span> <span class="fu">max</span>((slope_calc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>slope_long <span class="ot">&lt;-</span> slope <span class="sc">|&gt;</span> </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, segment_id, rank, index, mean_slope_up)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>slope_result <span class="ot">&lt;-</span> slope <span class="sc">|&gt;</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, rank) <span class="sc">|&gt;</span> </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">kat1 =</span> <span class="fu">sum</span>(mean_slope_up <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> mean_slope_up <span class="sc">&lt;=</span> <span class="dv">4</span>),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">kat2 =</span> <span class="fu">sum</span>(mean_slope_up <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">&amp;</span> mean_slope_up <span class="sc">&lt;=</span> <span class="dv">6</span>),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">kat3 =</span> <span class="fu">sum</span>(mean_slope_up <span class="sc">&gt;</span> <span class="dv">6</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>slope_sum <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(slope_result, <span class="sc">-</span><span class="fu">c</span>(type, segment_id, rank))</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>slope_sum<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">factor</span>(slope_sum<span class="sc">$</span>name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"kat1"</span>, <span class="st">"kat2"</span>, <span class="st">"kat3"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2-4%"</span>, <span class="st">"4-6%"</span>, <span class="st">"&gt;6%"</span>))</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>slope_final <span class="ot">&lt;-</span> slope_sum <span class="sc">|&gt;</span> </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, segment_id, name) <span class="sc">|&gt;</span> </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_count =</span> <span class="fu">mean</span>(value) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-slope_cat" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-slope_cat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<a href="figures/category.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;13: Average number of 100m subsegment per delivery with slopes of 2-4%, 4-6% or >6%"><img src="figures/category.png" id="fig-category" class="img-fluid figure-img"></a>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-slope_cat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Average number of 100m subsegment per delivery with slopes of 2-4%, 4-6% or &gt;6%
</figcaption>
</figure>
</div>
<p>We further calculated mean slope and maximum slope per subsegment of 100m in each trajectory and created density plots for a better overview <a href="#fig-slope_density" class="quarto-xref">Figure&nbsp;14</a>. Y-Axis show densities of subsegments while the X-Axis show mean/max slope in 100m segments in %. No statistical method was applied regarding slope.</p>
<div id="fig-slope_density" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-slope_density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-slope_density" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-mean_slope_up" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mean_slope_up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/mean_slope_up.png" class="lightbox" data-gallery="fig-slope_density" title="Figure&nbsp;14&nbsp;(a): mean positive slope per 100m subsegments"><img src="figures/mean_slope_up.png" class="img-fluid figure-img" data-ref-parent="fig-slope_density"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mean_slope_up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) mean positive slope per 100m subsegments
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-slope_density" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-max_slope_up" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-max_slope_up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/max_slope_up.png" class="lightbox" data-gallery="fig-slope_density" title="Figure&nbsp;14&nbsp;(b): max positive slope per 100m subsegments"><img src="figures/max_slope_up.png" class="img-fluid figure-img" data-ref-parent="fig-slope_density"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-max_slope_up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) max positive slope per 100m subsegments
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-slope_density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Mean and Max slopes averaged in 100 meter subsegment
</figcaption>
</figure>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>In our study, we demonstrated that bike messengers choose routes that are highly efficient in terms of route length. There are no statistical differences between the shortest possible alternatives and the chosen routes. In 42% of all cases, the original routes were the shortest possible paths. It is intuitive and supported by previous research (e.g. <span class="citation" data-cites="meister_descriptive_2021">Meister, Gupta, and Axhausen (<a href="#ref-meister_descriptive_2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="menghini2009route">Menghini et al. (<a href="#ref-menghini2009route" role="doc-biblioref">2009</a>)</span>, <span class="citation" data-cites="skov-petersen_how_2018">Skov-Petersen et al. (<a href="#ref-skov-petersen_how_2018" role="doc-biblioref">2018</a>)</span>) that route length significantly influences route choice.</p>
<p>Regarding the preference for street width, developing a suitable method proved challenging due to the lack of clear criteria for <em>preference</em>.</p>
<p>Concerning slope and height differences, the relevance of such an analysis within the spatial context of Zurich is questionable. While bike messengers do have the freedom to choose their routes, the departure and arrival points are fixed, and in a constrained spatial context like the city of Zurich, elevation changes are difficult to avoid. This might explains the low differences / relevance of slope in the present work, an instance that was observed in <span class="citation" data-cites="menghini2009route">Menghini et al. (<a href="#ref-menghini2009route" role="doc-biblioref">2009</a>)</span> as well. If suitable datasets covering a broader spatial context than Zurich were available, this analysis could yield more insightful results, as observed in other studies (e.g. <span class="citation" data-cites="skov-petersen_how_2018">Skov-Petersen et al. (<a href="#ref-skov-petersen_how_2018" role="doc-biblioref">2018</a>)</span>).</p>
<section id="map-matching" class="level3">
<h3 class="anchored" data-anchor-id="map-matching">Map matching</h3>
<p>Due to certain constraints and available resources, we adopted a simple approach of distance-based point-to-road matching, which has several limitations <span class="citation" data-cites="meister_descriptive_2021">(<a href="#ref-meister_descriptive_2021" role="doc-biblioref">Meister, Gupta, and Axhausen 2021</a>)</span>. More sophisticated methods, such as those using Hidden Markov Models (HMMs), are more effective as they consider factors like measurement noise and the road network structure, avoiding simplistic distance-based point-to-road matching <span class="citation" data-cites="newson2009hidden">(<a href="#ref-newson2009hidden" role="doc-biblioref">Newson and Krumm 2009</a>)</span>. For implementing map matching in intricate urban road networks, it is crucial to use tools that consider various sources of error linked with position sensors, the vehicle’s historical trajectory, topological data about the road network, and the vehicle’s direction and speed. These factors collectively help accurately determine the correct link where the vehicle is located <span class="citation" data-cites="ochieng_map-matching_2003">(<a href="#ref-ochieng_map-matching_2003" role="doc-biblioref">Ochieng, Quddus, and Noland 2003</a>)</span>.</p>
<p>There are also free and open-source solutions for better map matching. However, implementing them in R proved too time-consuming. Future projects could explore APIs from osrm<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> or valhalla<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
</section>
<section id="critical-reflection" class="level3">
<h3 class="anchored" data-anchor-id="critical-reflection">Critical reflection</h3>
<p>Uneven distributions and irregular sampling presents a challenge in computational movement analysis. A common approach is transforming unevenly spaced data into equally spaced data using interpolation. However, linear interpolation can introduce biases, data loss, or dilution <span class="citation" data-cites="eckner_framework_2014">(<a href="#ref-eckner_framework_2014" role="doc-biblioref">Eckner 2014</a>)</span>. When applied to our specific data and research question, these concerns were deemed acceptable.</p>
<p>We tried several approaches to even out the distribution or enrich the dataset or to make the amount / location of gps points irrelevant, all with unsatisfying results. For future projects, transforming GPS points into an existing road network with edges and points, as shown here<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> could be considered. This was not feasible due to poor map matching in our study.</p>
</section>
<section id="approach-in-generating-alternative-trajectories" class="level3">
<h3 class="anchored" data-anchor-id="approach-in-generating-alternative-trajectories">Approach in generating alternative trajectories</h3>
<p>Using an algorithm to generate alternative trajectories can create some unreasonable trajectories. This error source must be considered as the goal is to generate plausible alternatives. Research aims to improve network-based automatic calibration of the <em>doubly stochastic</em> method of <span class="citation" data-cites="hood_gps-based_2011">Hood, Sall, and Charlton (<a href="#ref-hood_gps-based_2011" role="doc-biblioref">2011</a>)</span>. This method produces more heterogeneous, attractive, unbiased, and exhaustive choice sets than other methods, yielding more reliable parameter estimates and predictions.</p>
<p>As illustrated in <a href="#fig-anova" class="quarto-xref">Figure&nbsp;10</a>, the average segment length increases with the number of available alternatives. This may be due to the fact that with an increased number of alternatives, more unrealistic and/or lengthy options were generated, which illustrates the described problem above.</p>
</section>
<section id="outlook" class="level3">
<h3 class="anchored" data-anchor-id="outlook">Outlook</h3>
<p>Due to the extensive data preprocessing, including interpolation, we lacked time to enrich the movement data with other relevant parameters. Future work could include and evaluate the following parameters:</p>
<ul>
<li>Number of intersections in a segment</li>
<li>Number of traffic lights/stops</li>
<li>Number of left/right turns</li>
<li>Proportion of bike lanes/bike routes in a segment</li>
<li>Traffic</li>
<li>Speed limits</li>
</ul>
<p>An interesting evaluation would be whether certain messengers are willing to take longer routes to avoid steeper ones. There are likely thresholds where increased route length does not justify reduced steepness anymore.</p>
<p>We have a large and dense dataset that can address many exciting questions. Unfortunately, limited access to the API from <code>here</code> prevented us from generating alternatives for all shifts from <code>raeubertochter</code> and <code>donner</code>. Future work should explore full API access or alternative programs to exploit the dataset’s full potential.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-broach2012cyclists" class="csl-entry" role="listitem">
Broach, Joseph, Jennifer Dill, and John Gliebe. 2012. <span>“Where Do Cyclists Ride? A Route Choice Model Developed with Revealed Preference GPS Data.”</span> <em>Transportation Research Part A: Policy and Practice</em> 46 (10): 1730–40.
</div>
<div id="ref-eckner_framework_2014" class="csl-entry" role="listitem">
Eckner, Andreas. 2014. <span>“A Framework for the Analysis of Unevenly Spaced Time Series Data.”</span>
</div>
<div id="ref-frejinger_route_2007" class="csl-entry" role="listitem">
Frejinger, Emma. 2007. <span>“Route Choice Analysis:data, Models, Algorithms and Applications,”</span> December. <a href="https://doi.org/10.5075/EPFL-THESIS-4009">https://doi.org/10.5075/EPFL-THESIS-4009</a>.
</div>
<div id="ref-halldorsdottir2014efficiency" class="csl-entry" role="listitem">
Halldórsdóttir, Katrı́n, Nadine Rieser-Schussler, Kay W Axhausen, Otto Anker Nielsen, and Carlo Giacomo Prato. 2014. <span>“Efficiency of Choice Set Generation Methods for Bicycle Routes.”</span> <em>European Journal of Transport and Infrastructure Research</em> 14 (4): 332–48.
</div>
<div id="ref-hood_gps-based_2011" class="csl-entry" role="listitem">
Hood, Jeffrey, Elizabeth Sall, and Billy Charlton. 2011. <span>“A <span>GPS</span>-Based Bicycle Route Choice Model for San Francisco, California.”</span> <em>Transportation Letters</em> 3 (1): 63–75. <a href="https://doi.org/10.3328/TL.2011.03.01.63-75">https://doi.org/10.3328/TL.2011.03.01.63-75</a>.
</div>
<div id="ref-laube_how_2011" class="csl-entry" role="listitem">
Laube, Patrick, and Ross S. Purves. 2011. <span>“How Fast Is a Cow? Cross‐scale Analysis of Movement Data.”</span> <em>Transactions in <span>GIS</span></em> 15 (3): 401–18. <a href="https://doi.org/10.1111/j.1467-9671.2011.01256.x">https://doi.org/10.1111/j.1467-9671.2011.01256.x</a>.
</div>
<div id="ref-meister_descriptive_2021" class="csl-entry" role="listitem">
Meister, Adrian, Isha Gupta, and Kay W. Axhausen. 2021. <span>“Descriptive Route Choice Analysis of Cyclists in Zurich,”</span> September, 25 p. <a href="https://doi.org/10.3929/ETHZ-B-000504160">https://doi.org/10.3929/ETHZ-B-000504160</a>.
</div>
<div id="ref-menghini2009route" class="csl-entry" role="listitem">
Menghini, Gianluca, Nelson Carrasco, Nadine Schüssler, and Kay W Axhausen. 2009. <span>“Route Choice of Cyclists in Zurich: GPS-Based Discrete Motion Models.”</span> <em>Arbeitsberichte Verkehrs-Und Raumplanung</em> 544.
</div>
<div id="ref-newson2009hidden" class="csl-entry" role="listitem">
Newson, Paul, and John Krumm. 2009. <span>“Hidden Markov Map Matching Through Noise and Sparseness.”</span> In <em>Proceedings of the 17th ACM SIGSPATIAL International Conference on Advances in Geographic Information Systems</em>, 336–43.
</div>
<div id="ref-ochieng_map-matching_2003" class="csl-entry" role="listitem">
Ochieng, Washington Y., Mohammed A. Quddus, and Robert B. Noland. 2003. <span>“Map-Matching in Complex Urban Road Networks.”</span> <em>Brazilian Journal of Cartography (Revista Brasileira de Cartografia)</em> 55 (2): 1–18.
</div>
<div id="ref-prato_route_2009" class="csl-entry" role="listitem">
Prato, Carlo Giacomo. 2009. <span>“Route Choice Modeling: Past, Present and Future Research Directions.”</span> <em>Journal of Choice Modelling</em> 2 (1): 65–100. <a href="https://doi.org/10.1016/S1755-5345(13)70005-8">https://doi.org/10.1016/S1755-5345(13)70005-8</a>.
</div>
<div id="ref-skov-petersen_how_2018" class="csl-entry" role="listitem">
Skov-Petersen, Hans, Bernhard Barkow, Thomas Lundhede, and Jette Bredahl Jacobsen. 2018. <span>“How Do Cyclists Make Their Way? - a <span>GPS</span>-Based Revealed Preference Study in Copenhagen.”</span> <em>International Journal of Geographical Information Science</em> 32 (7): 1469–84. <a href="https://doi.org/10.1080/13658816.2018.1436713">https://doi.org/10.1080/13658816.2018.1436713</a>.
</div>
</div>
</section>



<div id="quarto-appendix" class="default"><section id="wordcount" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Wordcount</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pacman"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">p_install_gh</span>(<span class="st">"benmarwick/wordcountaddin"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>wordcountaddin<span class="sc">::</span><span class="fu">word_count</span>(<span class="st">"index.qmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 919</code></pre>
</div>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://www.swisstopo.admin.ch/de/landschaftsmodell-swisstlm3d<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://www.swisstopo.admin.ch/de/hoehenmodell-dhm25<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://www.strava.com/dashboard<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://www.rdocumentation.org/packages/hereR/versions/1.0.0.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>http://project-osrm.org/<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>https://towardsdatascience.com/map-matching-done-right-using-valhallas-meili-f635ebd17053<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>https://r-spatial.org/r/2019/09/26/spatial-networks.html<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","closeEffect":"zoom","loop":false,"descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>